function [Amat,Bmat] = funJac(x,u)      % x and u are vector at that time stamp

global m XT  r L MI g nx ny lam Q R Qf m Denom

m1 = m(1);
m2 = m(2);

L1 = L(1);
L2 = L(2);
r1 = r(1);
r2 = r(2);
MI1 = MI(1);
MI2 = MI(2);
tht1 = x(1)
tht2 = x(2)
omg1 = x(3)
omg2 = x(4)


Amat=[0,0,1,0;0,0,0,1;(-1).*g.*L2.*m2.*(L2.^2.*m2+L1.*L2.*m2.*cos(tht2) ...
  ).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+L1.^2.* ...
  L2.^2.*m2.^2.*cos(tht2).^2).^(-1).*cos(tht1+tht2)+(-1).*L2.^2.* ...
  m2.*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+L1.^2.* ...
  L2.^2.*m2.^2.*cos(tht2).^2).^(-1).*((-1).*g.*L1.*(m1+m2).*cos( ...
  tht1)+(-1).*g.*L2.*m2.*cos(tht1+tht2)),(-1).*L2.^3.*m2.^2.*((-1).* ...
  L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.* ...
  m2.^2.*cos(tht2).^2).^(-1).*(L1.*omg2.*(2.*omg1+omg2).*cos(tht2)+( ...
  -1).*g.*cos(tht1+tht2))+(-1).*L2.*m2.*(L2.^2.*m2+L1.*L2.*m2.*cos( ...
  tht2)).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+ ...
  L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1).*(L1.*omg1.^2.*cos(tht2)+ ...
  g.*cos(tht1+tht2)),(-2).*L1.*L2.^3.*m2.^2.*omg2.*((-1).*L1.^2.* ...
  L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.*m2.^2.*cos( ...
  tht2).^2).^(-1).*sin(tht2)+(-2).*L1.*L2.*m2.*omg1.*(L2.^2.*m2+L1.* ...
  L2.*m2.*cos(tht2)).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.* ...
  L2.^2.*m2.^2+L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1).*sin(tht2),( ...
  -2).*L1.*L2.^3.*m2.^2.*(omg1+omg2).*((-1).*L1.^2.*L2.^2.*m1.*m2+( ...
  -1).*L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1) ...
  .*sin(tht2);(-1).*g.*L2.*m2.*((-1).*L1.^2.*m1+(-1).*L1.^2.*m2+(-1) ...
  .*L2.^2.*m2+(-2).*L1.*L2.*m2.*cos(tht2)).*((-1).*L1.^2.*L2.^2.* ...
  m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.*m2.^2.*cos(tht2) ...
  .^2).^(-1).*cos(tht1+tht2)+(L2.^2.*m2+L1.*L2.*m2.*cos(tht2)).*(( ...
  -1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.* ...
  m2.^2.*cos(tht2).^2).^(-1).*((-1).*g.*L1.*(m1+m2).*cos(tht1)+(-1) ...
  .*g.*L2.*m2.*cos(tht1+tht2)),L2.*m2.*(L2.^2.*m2+L1.*L2.*m2.*cos( ...
  tht2)).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+ ...
  L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1).*(L1.*omg2.*(2.*omg1+ ...
  omg2).*cos(tht2)+(-1).*g.*cos(tht1+tht2))+(-1).*L2.*m2.*((-1).* ...
  L1.^2.*m1+(-1).*L1.^2.*m2+(-1).*L2.^2.*m2+(-2).*L1.*L2.*m2.*cos( ...
  tht2)).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+ ...
  L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1).*(L1.*omg1.^2.*cos(tht2)+ ...
  g.*cos(tht1+tht2)),(-2).*L1.*L2.*m2.*omg1.*((-1).*L1.^2.*m1+(-1).* ...
  L1.^2.*m2+(-1).*L2.^2.*m2+(-2).*L1.*L2.*m2.*cos(tht2)).*((-1).* ...
  L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.* ...
  m2.^2.*cos(tht2).^2).^(-1).*sin(tht2)+2.*L1.*L2.*m2.*omg2.*( ...
  L2.^2.*m2+L1.*L2.*m2.*cos(tht2)).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1) ...
  .*L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1).* ...
  sin(tht2),2.*L1.*L2.*m2.*(omg1+omg2).*(L2.^2.*m2+L1.*L2.*m2.*cos( ...
  tht2)).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+ ...
  L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1).*sin(tht2)];




Bmat=[0,0;0,0;(-1).*L2.^2.*m2.*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1).* ...
  L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1),( ...
  L2.^2.*m2+L1.*L2.*m2.*cos(tht2)).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1) ...
  .*L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1);( ...
  L2.^2.*m2+L1.*L2.*m2.*cos(tht2)).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1) ...
  .*L1.^2.*L2.^2.*m2.^2+L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1),(( ...
  -1).*L1.^2.*m1+(-1).*L1.^2.*m2+(-1).*L2.^2.*m2+(-2).*L1.*L2.*m2.* ...
  cos(tht2)).*((-1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+ ...
  L1.^2.*L2.^2.*m2.^2.*cos(tht2).^2).^(-1)];


%Denom=(-1).*L1.^2.*L2.^2.*m1.*m2+(-1).*L1.^2.*L2.^2.*m2.^2+L1.^2.* ...
 % L2.^2.*m2.^2.*cos(tht2).^2;


Denom= -12+16*(cos(tht2))^2;

